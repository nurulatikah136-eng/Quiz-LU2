<!DOCTYPE html><html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Black & Gold Math Quiz ‚Ä¢ Miss Anis</title>
<style>
  /* Theme variables for consistent black & gold styling */
  :root{
    --bg:#0b0b0f;
    --panel:#111218;
    --text:#f7f7f5;
    --gold:#c9a227;
    --gold-2:#ffd56a;
    --muted:#9aa0a6;
    --danger:#ff6565;
    --ok:#30d158;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
    background:radial-gradient(1200px 1200px at 120% -10%, #1c1c27 0%, #0e0f14 55%, var(--bg) 100%);
    overflow-x:hidden;
  }
  header{
    position:sticky; top:0; z-index:20; backdrop-filter:blur(8px);
    background:linear-gradient(180deg, rgba(12,12,16,.85), rgba(12,12,16,.55));
    border-bottom:1px solid rgba(201,162,39,.18);
  }
  .bar{display:flex; align-items:center; gap:12px; padding:14px 18px; max-width:1100px; margin:auto}
  .brand{font-weight:800; letter-spacing:.3px}
  .brand span{color:var(--gold)}
  nav{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
  nav button{background:#161721; color:var(--text); border:1px solid rgba(201,162,39,.25); padding:10px 14px; border-radius:10px; cursor:pointer}
  nav button.active{border-color:var(--gold); box-shadow:0 0 0 2px rgba(201,162,39,.15) inset}
  .wrap{max-width:1100px; margin:20px auto; padding:16px}
  .page{display:none; animation:fade .35s ease}
  .page.active{display:block}
  @keyframes fade{from{opacity:.2; transform:translateY(6px)} to{opacity:1; transform:none}}
  .card{background:linear-gradient(180deg,#151622,#101119); border:1px solid rgba(201,162,39,.18); border-radius:16px; padding:18px}
  .grid{display:grid; gap:16px}
  .g12{grid-template-columns:repeat(12,1fr)}
  .btn{background:linear-gradient(180deg,#1d1e28,#14151f); color:var(--text); border:1px solid rgba(201,162,39,.35); padding:10px 14px; border-radius:10px; cursor:pointer}
  .btn.gold{background:linear-gradient(180deg,#2a2516,#1b170d); border-color:var(--gold); color:var(--gold-2)}
  .btn.ghost{background:transparent}
  .btn:disabled{opacity:.55; cursor:not-allowed}
  input,select,textarea{width:100%; padding:10px 12px; border-radius:10px; background:#0f1017; color:var(--text); border:1px solid rgba(201,162,39,.22)}
  table{width:100%; border-collapse:collapse}
  th,td{padding:10px 12px; border-bottom:1px solid rgba(201,162,39,.15); text-align:left}
  th{color:var(--gold-2); font-weight:700}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .kpi{background:linear-gradient(180deg,#181926,#101119); border:1px solid rgba(201,162,39,.2); border-radius:14px; padding:14px; text-align:center}
  .kpi b{font-size:22px; color:var(--gold-2)}
  .tag{display:inline-flex; align-items:center; gap:6px; padding:3px 8px; border:1px solid rgba(201,162,39,.25); border-radius:999px; font-size:12px; color:var(--muted)}
  .answer{display:block; padding:12px; border:1px solid rgba(201,162,39,.25); border-radius:12px; background:#0f1117; cursor:pointer}
  .answer.correct{border-color:#3ddc84}
  .answer.wrong{border-color:#ff6b6b}
  .muted{color:var(--muted)}
  .gold{color:var(--gold-2)}
  .center{text-align:center}
  .right{text-align:right}
  .notice{background:#191a22; border:1px dashed rgba(201,162,39,.35); padding:12px; border-radius:12px}
  .podium{display:flex; gap:14px; align-items:flex-end; justify-content:center; margin:14px 0}
  .ped{width:120px; background:#1a1b23; border:1px solid rgba(201,162,39,.25); border-radius:10px; padding:10px; text-align:center}
  .ped h4{margin:6px 0 0}
  .ped b{color:var(--gold-2)}
  .floating{
    pointer-events:none; position:fixed; inset:0; z-index:0; overflow:hidden;
  }
  .bit{position:absolute; font-weight:700; color:rgba(201,162,39,.38); animation:rise 18s linear infinite; font-size:18px}
  @keyframes rise{from{transform:translateY(110vh) translateX(0)} to{transform:translateY(-10vh) translateX(30px)}}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="brand">Black&nbsp;&amp;&nbsp;Gold <span>Math Quiz</span></div>
    <nav>
      <button data-go="page-home" class="active">Home</button>
      <button data-go="page-quiz">Quiz</button>
      <button data-go="page-student">Student</button>
      <button data-go="page-leaderboard">Leaderboard</button>
      <button data-go="page-cert">Certificate</button>
      <button data-go="page-teacher">Teacher</button>
    </nav>
  </div>
</header>
<div class="floating" id="floatLayer"></div>
<main class="wrap">
  <section id="page-home" class="page active">
    <div class="card">
      <h2>Registration</h2>
      <div class="grid" style="grid-template-columns:repeat(2,1fr)">
        <div>
          <label>Name</label>
          <input id="inName" placeholder="Full name" />
        </div>
        <div>
          <label>Matric Number</label>
          <input id="inMatric" placeholder="e.g. DPM1234" />
        </div>
        <div>
          <label>Class</label>
          <select id="inClass">
            <option value="">Select class</option>
            <option>H3D</option>
            <option>F1D</option>
            <option>H2D</option>
          </select>
        </div>
        <div class="right" style="align-self:end">
          <button class="btn gold" id="btnStart">Start Quiz</button>
        </div>
      </div>
      <p class="muted" style="margin-top:8px">Pastikan isi <b>name, class, matric</b> sebelum mula.</p>
    </div>
  </section>  <section id="page-quiz" class="page">
    <div class="card">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div class="tag">‚è≥ Time <b id="liveTime">0s</b></div>
        <div class="tag">Question <b id="qProgress">0/0</b></div>
      </div>
      <h3 id="qTitle" style="margin:14px 0 6px"></h3>
      <div id="qBody" class="grid" style="gap:10px"></div>
      <div class="row" style="justify-content:space-between; margin-top:12px">
        <button class="btn ghost" id="btnPrev">Back</button>
        <div class="row">
          <button class="btn" id="btnNext">Next</button>
          <button class="btn gold" id="btnSubmit" disabled>Submit Answers</button>
        </div>
      </div>
    </div>
  </section>  <section id="page-student" class="page">
    <div class="card">
      <h2>Student Dashboard</h2>
      <div class="row">
        <div class="kpi"><div>Score</div><b id="kScore">-</b></div>
        <div class="kpi"><div>Time</div><b id="kTime">-</b></div>
        <div class="kpi"><div>Rank</div><b id="kRank">-</b></div>
      </div>
      <div class="notice" style="margin:12px 0">
        <div><b>Recommendations</b></div>
        <div id="recText" class="muted"></div>
      </div>
      <h3>Answer Review</h3>
      <div id="reviewList" class="grid"></div>
      <div class="row" style="justify-content:space-between; margin-top:12px">
        <button class="btn" data-go="page-leaderboard">View Leaderboard</button>
        <button class="btn gold" data-go="page-cert">Generate Certificate</button>
      </div>
    </div>
  </section>  <section id="page-leaderboard" class="page">
    <div class="card">
      <h2>Leaderboard</h2>
      <div id="top3" class="podium"></div>
      <table>
        <thead><tr><th>#</th><th>Name</th><th>Class</th><th>Matric</th><th>Score</th><th>Time(s)</th><th>Date</th></tr></thead>
        <tbody id="lbRows"></tbody>
      </table>
      <div class="notice" style="margin-top:10px">Top 3 winners sila collect <b>hadiah</b> dari Miss Anis üéÅ</div>
    </div>
  </section>  <section id="page-cert" class="page">
    <div class="card center">
      <h2>Certificate</h2>
      <div id="certBox" style="margin:10px auto; width:900px; max-width:100%; background:#fff; color:#222; border:10px double #c9a227; border-radius:6px; padding:32px">
        <div style="font-size:28px; letter-spacing:.8px; color:#8b6b00">Certificate of Achievement</div>
        <div class="muted" style="color:#333">Presented to</div>
        <div id="certName" style="font-size:32px; font-weight:800; margin:8px 0">-</div>
        <div>for achieving</div>
        <div id="certScore" style="font-size:26px; font-weight:700; color:#8b6b00; margin:6px 0">-</div>
        <div>in the Mathematics Quiz</div>
        <div style="margin-top:10px">Date: <span id="certDate"></span></div>
      </div>
      <div class="row center" style="justify-content:center; margin-top:10px">
        <button class="btn" id="btnDownload">Download PNG</button>
      </div>
    </div>
  </section>  <section id="page-teacher" class="page">
    <div class="card">
      <h2>Teacher Admin</h2>
      <div id="gateBox" class="grid" style="grid-template-columns:1fr auto; gap:10px">
        <input id="inPass" type="password" placeholder="Enter password" />
        <button class="btn gold" id="btnGate">Enter</button>
      </div>
      <div id="adminBox" style="display:none; margin-top:12px">
        <div class="row" style="justify-content:space-between; align-items:center">
          <div class="row">
            <select id="filterClass">
              <option value="">All Classes</option>
              <option>H3D</option>
              <option>F1D</option>
              <option>H2D</option>
            </select>
            <button class="btn" id="btnExport">Export CSV</button>
          </div>
          <button class="btn" id="btnClear">Clear All Results</button>
        </div>
        <table style="margin-top:10px">
          <thead><tr><th>Name</th><th>Class</th><th>Matric</th><th>Score</th><th>Time(s)</th><th>Date</th><th></th></tr></thead>
          <tbody id="admRows"></tbody>
        </table>
      </div>
    </div>
  </section>
</main><script>
  // Floating math symbols generator; subtle, low-motion; improves ambience without noise
  const FLOATS = ["œÄ","‚àö","‚àë","‚àû","‚àÜ","‚â†","‚âà","|x|","‚Üí","‚à´","‚â°","Œ∏"]; // pool of glyphs
  const layer = document.getElementById('floatLayer');
  let seeds = 28; // number of floating bits
  for(let i=0;i<seeds;i++){
    const s=document.createElement('div'); s.className='bit'; s.textContent=FLOATS[Math.floor(Math.random()*FLOATS.length)];
    s.style.left=Math.random()*100+'vw'; s.style.animationDelay=(Math.random()*-18)+'s'; s.style.opacity=0.35+Math.random()*0.2; s.style.fontSize=(14+Math.random()*14)+'px';
    layer.appendChild(s);
  }

  // Simple router for multi-section pages; toggles visibility and active nav state
  const pages=[...document.querySelectorAll('.page')];
  const navBtns=[...document.querySelectorAll('nav button')];
  function showPage(id){
    pages.forEach(p=>p.classList.toggle('active', p.id===id));
    navBtns.forEach(b=>b.classList.toggle('active', b.dataset.go===id));
    if(id==='page-leaderboard') buildLeaderboard();
    if(id==='page-student') loadStudentView();
    if(id==='page-cert') loadCertificateView();
  }
  navBtns.forEach(b=>b.addEventListener('click',()=>showPage(b.dataset.go)));

  // Basic safe storage helpers for Canva (localStorage only)
  function getStore(key, fallback){
    try{const v=localStorage.getItem(key); return v? JSON.parse(v): fallback;}catch(e){return fallback}
  }
  function setStore(key, value){ localStorage.setItem(key, JSON.stringify(value)); }

  // User session state (who is taking the quiz now)
  let session = getStore('session', null);

  // Quiz database; each entry defines type, prompt, options, correct, and solution steps
  const DB = (function(){
    const subjective = {
      id:'Q1', type:'subjective', title:'Question 1 (Subjective): State the terminology for each description.',
      parts:[
        {k:'(a) The values resulting in an equation or inequality to be true.', a:'Solution'},
        {k:'(b) The term ax^2 in the quadratic expression ax^2 + bx + c.', a:'Quadratic term'},
        {k:'(c) The multiplicative factor of x in linear or quadratic expression.', a:'Linear coefficient'},
        {k:'(d) The values resulting in an expression to evaluate to zero.', a:'Zeroes'},
        {k:'(e) The other terminology for absolute value of x.', a:'Modulus'}
      ],
      steps:'Match each description to the correct terminology.'
    };

    const MC = [
      { id:'Q2', q:'Solve: ‚àö(2x + 3) + ‚àö(x - 2) = 4', choices:['x = 83','x = 4','x = 3','x = 2'], correct:2, steps:'Isolate one root, square both sides carefully, check extraneous. Valid solution: x = 3.' },
      { id:'Q3', q:'(x^2 + 3x + 2)/(x + 1) ‚â• 0', choices:['(-‚àû,-1) ‚à™ (-1,‚àû)','[-2,-1) ‚à™ (-1,‚àû)','(-‚àû,-2] ‚à™ (-1,‚àû)','[-2,‚àû)'], correct:1, steps:'Factor numerator: (x+1)(x+2). Sign chart with critical points x=-2 and x=-1 (hole). Satisfying: [-2,-1) ‚à™ (-1,‚àû).'},
      { id:'Q4', q:'(3x + 2)(2x + 5) < 0', choices:['(-‚àû,-5/2)','(-5/2,-2/3)','(-2/3,‚àû)','(-‚àû,-2/3)'], correct:1, steps:'Roots at -5/2 and -2/3. Product < 0 between the roots.'},
      { id:'Q5', q:'((x + 2)(x - 1))/(x + 1) < 0', choices:['(-‚àû,-2) ‚à™ (-1,1)','(-‚àû,-1) ‚à™ (1,‚àû)','(-2,-1) ‚à™ (1,‚àû)','(-‚àû,1)'], correct:0, steps:'Critical points: -2,-1,1. Test intervals; denominator ‚â† -1. Satisfying: (-‚àû,-2) ‚à™ (-1,1).'},
      { id:'Q6a', q:'(2x - 1)/(x - 1) > 1', choices:['(0,1)','(-‚àû,0) ‚à™ (1,‚àû)','(0,‚àû)','(1,‚àû)'], correct:1, steps:'Move 1: ((2x-1)-(x-1))/(x-1) > 0 ‚Üí (x)/(x-1) > 0 ‚Üí sign chart ‚áí (-‚àû,0) ‚à™ (1,‚àû).'},
      { id:'Q6b', q:'(x^2 - 3x + 2)/(x - 3) ‚â• 0', choices:['(-‚àû,1] ‚à™ [2,3)','[1,2] ‚à™ (3,‚àû)','(1,2) ‚à™ (3,‚àû)','[1,3)'], correct:1, steps:'Factor numerator (x-1)(x-2). Critical points 1,2,3. Use sign chart ‚áí [1,2] ‚à™ (3,‚àû).'},
      { id:'Q7', q:'|5x + 7| > |4x - 6|', choices:['(-‚àû,-13) ‚à™ (-1,9)','(-‚àû,-13) ‚à™ (-1/9,‚àû)','(-13,-1/9)','(-1/9,13)'], correct:1, steps:'Square both sides or analyze distance; simplifies to regions x < -13 or x > -1/9.'},
      { id:'Q8', q:'|3x + 4| ‚â• |x + 2|', choices:['(-‚àû,-1] ‚à™ [2,‚àû)','(-‚àû,-3/2] ‚à™ [-1,‚àû)','[-1,‚àû)','(-‚àû,-3/2)'], correct:1, steps:'Compare squares: (3x+4)^2 ‚â• (x+2)^2 ‚Üí 8x^2 + 20x + 12 ‚â• 0 ‚áí intervals ‚áí (-‚àû,-3/2] ‚à™ [-1,‚àû).'},
      { id:'Q9', q:'|(x + 3)/x| > 1', choices:['(-‚àû,-3/2) ‚à™ (0,‚àû)','(-3/2,0) ‚à™ (0,‚àû)','(-‚àû,0)','(0,‚àû)'], correct:1, steps:'Consider x‚â†0. Solve |x+3| > |x| ‚áí region (-3/2,0) and (0,‚àû).'},
      { id:'Q10', q:'Solve 2x^2 - 3x - 4 = 0', choices:['x=(3¬±‚àö41)/2','x=(-3¬±‚àö41)/4','x=(3¬±‚àö41)/4','x=(3¬±‚àö41)/8'], correct:2, steps:'Quadratic formula a=2,b=-3,c=-4 ‚Üí x=(3¬±‚àö41)/4.'}
    ];
    return {subjective, MC};
  })();

  // Active quiz runtime state per session
  const quizState = {
    startedAt:null, finishedAt:null, order:[], index:0, answers:{}, duration:0
  };

  // Build the runtime list by shuffling Q1 + MC, keeping subjective first but its parts are graded textually
  function prepareQuiz(){
    const order = [DB.subjective, ...DB.MC.map(x=>x)];
    const mcOnly = order.slice(1).sort(()=>Math.random()-0.5);
    quizState.order = [order[0], ...mcOnly];
    quizState.index = 0; quizState.answers={}; quizState.startedAt=Date.now(); quizState.finishedAt=null; quizState.duration=0;
    renderQuestion(); startLiveTimer();
  }

  // Live timer for the quiz page; stops on submit
  let tick=null;
  function startLiveTimer(){ clearInterval(tick); tick=setInterval(()=>{
    const s=Math.floor(((quizState.finishedAt||Date.now())-quizState.startedAt)/1000);
    document.getElementById('liveTime').textContent=s+'s';
  },1000); }
  function stopLiveTimer(){ clearInterval(tick); }

  // Render current question; subjective shows text inputs; MC shows buttons
  function renderQuestion(){
    const total = quizState.order.length; const i = quizState.index; const item = quizState.order[i];
    document.getElementById('qProgress').textContent=(i+1)+'/'+total;
    const t=document.getElementById('qTitle'); const body=document.getElementById('qBody'); body.innerHTML='';
    if(item.type==='subjective'){
      t.textContent=item.title;
      item.parts.forEach((p,pi)=>{
        const wrap=document.createElement('div');
        wrap.innerHTML=`<div style="margin:6px 0">${p.k}</div>`;
        const input=document.createElement('input'); input.placeholder='Type your term...'; input.value=(quizState.answers['Q1.'+(pi+1)]||'');
        input.addEventListener('input',()=>{ quizState.answers['Q1.'+(pi+1)]=input.value; });
        wrap.appendChild(input); body.appendChild(wrap);
      });
    }else{
      t.textContent=item.q;
      item.choices.forEach((c,ci)=>{
        const btn=document.createElement('button'); btn.className='answer'; btn.textContent=c;
        if(quizState.answers[item.id]===ci) btn.classList.add('correct');
        btn.addEventListener('click',()=>{ quizState.answers[item.id]=ci; [...body.children].forEach(ch=>ch.classList.remove('correct')); btn.classList.add('correct'); });
        body.appendChild(btn);
      });
    }
    document.getElementById('btnPrev').disabled = (i===0);
    document.getElementById('btnNext').disabled = (i>=total-1);
    document.getElementById('btnSubmit').disabled = (i<total-1);
  }

  // Navigation controls for quiz
  document.getElementById('btnPrev').addEventListener('click',()=>{ if(quizState.index>0){ quizState.index--; renderQuestion(); }});
  document.getElementById('btnNext').addEventListener('click',()=>{ const total=quizState.order.length; if(quizState.index<total-1){ quizState.index++; renderQuestion(); }});
  document.getElementById('btnSubmit').addEventListener('click',()=>{ if(!confirm('Submit now? You cannot change answers after submitting.')) return; finalizeQuiz(); });

  // Grade subjective by forgiving comparison (case/space insensitive)
  function eqTerm(user, key){ if(!user) return false; return user.trim().toLowerCase()===key.trim().toLowerCase(); }

  // Compute score, build detailed report, persist and go to student page
  function finalizeQuiz(){
    quizState.finishedAt=Date.now(); stopLiveTimer();
    const total=quizState.order.length; const secs=Math.floor((quizState.finishedAt-quizState.startedAt)/1000); quizState.duration=secs;

    let correct=0; const details=[];
    // Subjective grading
    DB.subjective.parts.forEach((p,idx)=>{
      const key='Q1.'+(idx+1); const user=quizState.answers[key]||''; const ok=eqTerm(user,p.a); if(ok) correct++;
      details.push({ id:'Q1'+String.fromCharCode(97+idx), type:'text', question:p.k, your:user, answer:p.a, correct:ok, steps:DB.subjective.steps });
    });
    // MCQ grading
    DB.MC.forEach(q=>{
      const pick=quizState.answers[q.id]; const ok=(pick===q.correct); if(ok) correct++; const your = (typeof pick==='number')? q.choices[pick]:'';
      details.push({ id:q.id, type:'mcq', question:q.q, your, answer:q.choices[q.correct], correct:ok, steps:q.steps });
    });

    const profile = getStore('session', null) || {name:'Anonymous', class:'', matric:''};
    const attempt = { name:profile.name, class:profile.class, matric:profile.matric, score:correct, total, time:secs, date:new Date().toLocaleString(), details };

    const all=getStore('results',[]); all.push(attempt); setStore('results',all);
    setStore('lastAttempt', attempt);

    loadStudentView(); showPage('page-student');
  }

  // Build student dashboard view based on last attempt and class ranking
  function loadStudentView(){
    const last=getStore('lastAttempt', null); if(!last){ document.getElementById('reviewList').innerHTML='<div class="muted">No attempt yet.</div>'; return; }
    const pct=Math.round((last.score/last.total)*100);
    document.getElementById('kScore').textContent=pct+'%';
    document.getElementById('kTime').textContent=last.time+'s';

    const sorted = getStore('results',[]).slice().sort((a,b)=> (b.score-a.score)|| (a.time-b.time));
    const rank = sorted.findIndex(x=> x.name===last.name && x.matric===last.matric && x.date===last.date) + 1;
    document.getElementById('kRank').textContent= rank>0? '#'+rank : '-';

    let rec='';
    if(pct>=90) rec='Excellent mastery. Try timed drills to push speed.';
    else if(pct>=75) rec='Great work. Review any missed inequalities.';
    else if(pct>=60) rec='Revise sign charts and absolute value logic.';
    else rec='Start with factorization and domain checks, then attempt again.';
    document.getElementById('recText').textContent=rec;

    const box=document.getElementById('reviewList'); box.innerHTML='';
    last.details.forEach((d,i)=>{
      const wrap=document.createElement('div'); wrap.className='card';
      const verdict = d.correct? '‚úÖ Correct':'‚ùå Incorrect';
      wrap.innerHTML = `<div><b>Q${i+1}.</b> ${d.question}</div>
        <div class="muted" style="margin:6px 0">Your answer: <span class="${d.correct?'gold':''}">${d.your||'-'}</span> &nbsp; <span>${verdict}</span></div>
        <div>Step-by-step: <span class="muted">${(d.steps||'').replace(/\n/g,'<br>')}</span></div>
        <div>Correct answer: <b class="gold">${d.answer}</b></div>`;
      box.appendChild(wrap);
    });
  }

  // Leaderboard build; also shows podium top-3
  function buildLeaderboard(){
    const rows=document.getElementById('lbRows'); rows.innerHTML='';
    const all=getStore('results',[]).slice().sort((a,b)=> (b.score-a.score)|| (a.time-b.time));
    const top=document.getElementById('top3'); top.innerHTML='';

    const podium = all.slice(0,3);
    const medals=['ü•á','ü•à','ü•â'];
    podium.forEach((p,i)=>{
      const div=document.createElement('div'); div.className='ped';
      div.innerHTML=`<div style="font-size:26px">${medals[i]}</div><b>${p.name}</b><div class="muted">${p.class}</div><h4>${p.score}/${p.total} ‚Ä¢ ${p.time}s</h4>`;
      top.appendChild(div);
    });

    all.forEach((r,i)=>{
      const tr=document.createElement('tr');
      const rank = i<3? medals[i] : (i+1);
      tr.innerHTML=`<td>${rank}</td><td>${r.name}</td><td>${r.class}</td><td>${r.matric}</td><td>${Math.round(r.score/r.total*100)}%</td><td>${r.time}</td><td>${r.date}</td>`;
      rows.appendChild(tr);
    });
  }

  // Teacher gate and admin table operations
  const SECRET='Anis120467//';
  document.getElementById('btnGate').addEventListener('click',()=>{
    const ok = document.getElementById('inPass').value===SECRET;
    if(!ok){ alert('Wrong password'); return; }
    document.getElementById('gateBox').style.display='none';
    document.getElementById('adminBox').style.display='block';
    renderAdmin();
  });

  function renderAdmin(){
    const body=document.getElementById('admRows'); body.innerHTML='';
    const cls=document.getElementById('filterClass').value;
    const all=getStore('results',[]).filter(x=> !cls || x.class===cls).sort((a,b)=> (b.score-a.score)|| (a.time-b.time));
    all.forEach((r,idx)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.name}</td><td>${r.class}</td><td>${r.matric}</td><td>${Math.round(r.score/r.total*100)}%</td><td>${r.time}</td><td>${r.date}</td><td class="right"><button class="btn" data-del="${r.date}">Delete</button></td>`;
      body.appendChild(tr);
    });
    body.querySelectorAll('button[data-del]').forEach(b=> b.addEventListener('click',()=>{
      const id=b.getAttribute('data-del');
      const rest=getStore('results',[]).filter(x=> x.date!==id);
      setStore('results',rest); renderAdmin(); buildLeaderboard();
    }));
  }
  document.getElementById('filterClass').addEventListener('change',renderAdmin);
  document.getElementById('btnClear').addEventListener('click',()=>{
    if(!confirm('Clear all results?')) return; setStore('results',[]); renderAdmin(); buildLeaderboard();
  });
  document.getElementById('btnExport').addEventListener('click',()=>{
    const all=getStore('results',[]);
    const head=['Name','Class','Matric','Score%','Time','Date'];
    const lines=[head.join(',')];
    all.forEach(r=>{ lines.push([r.name,r.class,r.matric,Math.round(r.score/r.total*100)+'%',r.time,r.date].map(v=> '"'+String(v).replace(/"/g,'""')+'"').join(',')); });
    const blob=new Blob([lines.join('\n')],{type:'text/csv'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='results.csv'; a.click(); URL.revokeObjectURL(a.href);
  });

  // Certificate view pulls last attempt; download via html2canvas
  function loadCertificateView(){
    const last=getStore('lastAttempt', null); if(!last) return;
    document.getElementById('certName').textContent= last.name+' ('+last.class+')';
    document.getElementById('certScore').textContent= Math.round(last.score/last.total*100)+'% in '+last.time+'s';
    document.getElementById('certDate').textContent= new Date(last.date).toLocaleDateString();
  }

  document.getElementById('btnDownload').addEventListener('click',()=>{
    if(typeof html2canvas==='undefined'){ alert('Downloader not loaded'); return; }
    html2canvas(document.getElementById('certBox'),{backgroundColor:null, scale:2}).then(canvas=>{
      const a=document.createElement('a'); a.download='certificate.png'; a.href=canvas.toDataURL('image/png'); a.click();
    });
  });

  // Start button validates registration and starts quiz
  document.getElementById('btnStart').addEventListener('click',()=>{
    const name=document.getElementById('inName').value.trim();
    const cls=document.getElementById('inClass').value.trim();
    const matric=document.getElementById('inMatric').value.trim();
    if(!name||!cls||!matric){ alert('Please fill name, class, and matric.'); return; }
    session={name, class:cls, matric}; setStore('session',session);
    showPage('page-quiz'); prepareQuiz();
  });

  // Nav shortcut buttons inside pages
  document.querySelectorAll('[data-go]').forEach(b=> b.addEventListener('click',()=> showPage(b.dataset.go)));

</script><script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5q2o7/8X9G0J0YhNnZcYq2R8mV0v7Gq9Q8F0q0Hc7j0C0j0wWb5qX8b3QhYcHcM5m6G5b9b3r3G3G5H5hA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script></body>
</html>
